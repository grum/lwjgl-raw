<project name="applet">

	<!-- Create our packer task -->
	<taskdef name="pack200" classname="com.sun.tools.apache.ant.pack200.Pack200Task" classpath="platform_build/Pack200Task.jar"/>

	<target name="applet" depends="all">
		<antcall target="-applet">
		    <param name="keystore" value="applet/lwjglkeystore"/>
			<param name="alias" value="lwjgl"/>			
			<param name="password" value="123456"/>			
		  </antcall>
	</target>
	
	<target name="applet-release">
		<input 	message="Please type the password for the keystore" addproperty="sign.pwd"/>

		<antcall target="-applet">
		  <param name="keystore" value="signing/matzon_java_code_signing.keystore"/>
			<param name="alias" value="oddlabs_java_code_signing"/>
			<param name="password" value="${sign.pwd}"/>
		</antcall>
	</target>

	<target name="-applet">
	
		<!-- Create lwjgl_applet.jar -->
		<jar destfile="applet/lwjgl_applet.jar" taskname="lwjgl_applet.jar">
			<fileset refid="lwjgl_applet.fileset" />
		</jar>
		
		<!-- create each of the native jars -->
		<jar destfile="applet/windows_natives.jar" taskname="windows_natives.jar">
			<fileset dir="${lwjgl.lib}/win32">
				<patternset refid="lwjgl-win32.fileset"/>
			</fileset>
		</jar>
		<signjar jar="applet/windows_natives.jar" alias="${alias}" keystore="${keystore}" storepass="${password}"/>
		
		<jar destfile="applet/linux_natives.jar" taskname="linux_natives.jar">
			<fileset dir="${lwjgl.lib}/linux">
				<patternset refid="lwjgl-linux.fileset"/>
			</fileset>
		</jar>
		<signjar jar="applet/linux_natives.jar" alias="${alias}" keystore="${keystore}" storepass="${password}"/>
			
		<jar destfile="applet/macosx_natives.jar" taskname="macosx_natives.jar">
			<fileset dir="${lwjgl.lib}/macosx">
				<patternset refid="lwjgl-macosx.fileset"/>
			</fileset>
		</jar>
		<signjar jar="applet/macosx_natives.jar" alias="${alias}" keystore="${keystore}" storepass="${password}"/>
			
	  	<jar destfile="${lwjgl.lib}/lwjgl_util_applet.jar" update="true">
	  		<fileset dir="${lwjgl.res}" includes="applet*"/>
	  	</jar>

	  <copy file="${lwjgl.lib}/lwjgl.jar" todir="applet"/>
		<copy file="${lwjgl.lib}/lwjgl_util_applet.jar" todir="applet"/>
		<copy file="${lwjgl.lib}/lwjgl_util.jar" todir="applet"/>
		<copy file="${lwjgl.lib}/jinput.jar" todir="applet"/>
		<copy file="${lwjgl.lib}/lzma.jar" todir="applet"/>
		<zip destfile="applet/res.jar">
		  <zipfileset dir="${lwjgl.res}" includes="Footsteps.wav, ILtest.tga, Missing_you.mod"/>
		</zip>
		
		<!--<antcall target="applet-compress">
			<param name="dir" value="applet/"/>
			<param name="jarfile" value="lwjgl"/>
		</antcall>
		<fail/>-->
	</target>
	
	<target name="applet-compress">
		<antcall target="repack">
			<param name="input" value="${dir}${jarfile}.jar"/>
			<param name="output" value="${dir}${jarfile}-repack.jar"/>
		</antcall>
		<signjar jar="${dir}${jarfile}.jar" alias="${alias}" keystore="${keystore}" storepass="${password}"/>
		<signjar jar="${dir}${jarfile}-repack.jar" alias="${alias}" keystore="${keystore}" storepass="${password}"/>
		<antcall target="pack">
			<param name="input" value="${dir}${jarfile}-repack.jar"/>
			<param name="output" value="${dir}${jarfile}.jar.pack"/>
		</antcall>
		<antcall target="lzma">
			<param name="input" value="${dir}${jarfile}.jar.pack"/>
			<param name="output" value="${dir}${jarfile}.jar.pack.lzma"/>
		</antcall>
		<antcall target="lzma">
			<param name="input" value="${dir}${jarfile}.jar"/>
			<param name="output" value="${dir}${jarfile}.jar.lzma"/>
		</antcall>
		<delete file="${dir}${jarfile}-repack.jar"/>
	</target>
</project>